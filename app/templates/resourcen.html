{% extends "base.html" %}
{% set active_page = "views.resourcen" %}
{% block content %}
<link href="/static/css/jellyfish.css" rel=stylesheet type="text/css" media=screen>
<link href="/static/css/pie.css" rel=stylesheet type="text/css" media=screen>

{% if not cinema_mode %}
<div class="btn-group">
    <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
            aria-expanded="false">
        Status Level<span class="caret"></span>
    </button>
    <ul class="dropdown-menu">
        <li><a class="js_level_filter" data-level="0">OK (0)</a></li>
        <li><a class="js_level_filter" data-level="1">Unknown (1)</a></li>
        <li><a class="js_level_filter" data-level="2">Warning (2)</a></li>
        <li><a class="js_level_filter" data-level="3">Error (3)</a></li>
    </ul>
</div>
{% endif %}

<div role="tabpanel">
    {%- if parameter.tab %}
    {%- set tab = parameter.tab %}
    {%- else %}
    {%- set tab = tabs[0] %}
    {%- endif %}

    {% if not cinema_mode %}
    <ul class="nav-tabs nav" role="tablist">
        {%- for group in tabs | sort %}
        <li role="presentation" data-group="{{group}}" class="tab-title {% if tab == group %} active {% endif %}">
            <a href="#{{group}}" name="#{{group}}" aria-controls="{{group}}" role="tab" data-toggle="tab">{{group}}
                <span class="badge">{{state[group]|length}}</span></a>
        </li>


        {% endfor %}
    </ul>
    {%- endif -%}


    <div class="tab-content">
        {%- for vertical in tabs %}
        {%- if not cinema_mode or tab == vertical %}
        <div role="tabpanel" class="tab-pane fade {% if tab == vertical %} active in {% endif %} grid"
             id="{{vertical}}">
            {%- for error in errors[vertical] %}
            <div class="alert alert-danger" role="alert">
                <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                {{error}}
            </div>
            {% endfor %}
            {% if state[vertical]|length != 0 %}
            {%- if not cinema_mode %}
            <div>Vertical usage total:
                <span class="label label-info">CPU: {{vertical_ressources[vertical].cpu | round(2) }}</span>
                <span class="label label-info">MEM: {{ '{0:,}'.format(vertical_ressources[vertical].mem | round(2) ) }}</span>
                <span class="label label-unflashy">CPU MAX: {{vertical_ressources[vertical].max_cpu | round(2) }}</span>
                <span class="label label-unflashy">MEM MAX: {{ '{0:,}'.format( vertical_ressources[vertical].max_mem | round(2) ) }}</span>
                <span class="label label-unflashy">max values are 99p over the last 14 days</span>
            </div>
            {%- endif %}

            <table class="table table-condensed">
                <th>
                    {%- for group in environments %}
                <td><b>{{group.alias}}</b></td>
                {% endfor %}
                </th>

                {%- for name, groups in state[vertical].items() | sort %}
                <tr>
                    <td class="service_info_width">
                        <div>{{ name }}</div>
                        <div class="small">
                            <div><span class="label label-unflashy">CPU: {{app_ressources[vertical][name].cpu}}</span>
                            </div>
                            <div>
                                <span class="label label-unflashy">CPU MAX: {{'{0:,}'.format(app_ressources[vertical][name].max_cpu | round(2))}}</span>
                            </div>
                            <div><span class="label label-unflashy">MEM: {{'{0:,}'.format(app_ressources[vertical][name].mem)}}</span>
                            </div>
                            <div>
                                <span class="label label-unflashy">MEM MAX: {{'{0:,}'.format(app_ressources[vertical][name].max_mem | round(2))}}</span>
                            </div>
                        </div>
                    </td>
                    {%- for group in environments %}
                    {%- if group.name in groups %}
                    <td class="env_width">
                        {% set service = groups[group.name] %}
                        {% include "resource_tile.html" %}
                    </td>
                    {% else %}
                    <td class="env_width"></td>
                    {% endif %}
                    {% endfor %}
                </tr>
                {% endfor %}
            </table>
            {% else %}
            <h1>
                <span class="text-success glyphicon glyphicon-thumbs-up"></span>
            </h1>
            {% endif %}
        </div>
        {%- endif %}
        {%- endfor %}
    </div>
</div>

{% if not cinema_mode %}
<small><a href="/monitor/cinema{{url_query}}">Cinema mode</a></small>
{% else %}
<small><a href="/monitor{{url_query}}">Normal mode</a></small>
{% endif %}
{% endblock %}
